<title>Riverside Mutual Aid Map</title>

<link rel="icon" href="https://img.icons8.com/cotton/2x/like.png" type="image/png" sizes="16x16">
		
<script>
	function initMap() {
		var xmlHttp = new XMLHttpRequest();
		xmlHttp.onreadystatechange = function() {
			if (xmlHttp.readyState != 4) {
				return;
			}
			if (!xmlHttp.response) {
				return;
			}
			var volunteerData = JSON.parse(xmlHttp.response);
			setupMap(volunteerData.feed.entry);
		}
		xmlHttp.open("GET", "https://spreadsheets.google.com/feeds/cells/1V4F02LbP8feQXTKX_l1ES9kv4udM09l59KPWr4r4J9w/1/public/full?alt=json", true);
		xmlHttp.send(null);
	}

	function setupMap(entries) {
		var location = {
			lat: 51.486, 
			lng: -3.199
		};
		var map = new google.maps.Map(document.getElementById('map'), {
			zoom: 15,
			center: location
		});
		createMarkers(map, entries);
	}
	
	async function createMarkers(map, entries) {
		var geocoder = new google.maps.Geocoder;
		var rowIndex = 8;
		while (true) {
			if (entries[rowIndex].content["$t"] === "Grand Total") {
				break;
			}
			await geocoder.geocode({
				componentRestrictions: {
					country: 'UK',
					postalCode: entries[rowIndex + 3].content["$t"]
				}
			}, function(results, status) {
				if (status == 'OK') {
					var marker = new google.maps.Marker({
						position: results[0].geometry.location,
						map: map
					});
				}
			});
			rowIndex += 8;
		}
	}
</script>

<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD8vc1RPEOEOOeqHIzTMsbWyNo8gk-sw_0&callback=initMap"></script>

<div id="map" style="width:100%; height:100%;"></div>